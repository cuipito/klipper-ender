# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v3.0. To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication/USART.

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.

# See docs/Config_Reference.md for a description of parameters.
#[bltouch]
#sensor_pin: PC14
#control_pin: PA1
#x_offset: -40
#y_offset: -10
#z_offset: 3.0
#speed:
#[include Adxl345.cfg]
[include fluidd.cfg]
[include macro.cfg]
[include mainsail.cfg]
[include eddy.cfg]
#[include moonraker.conf]
[exclude_object]

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 60.4
shaper_type_y = mzv
shaper_freq_y = 38.2

#[bltouch]
#sensor_pin: ^PC14
#control_pin: PA1
#x_offset: -31.8
#y_offset: -47.0
#speed: 300
#samples: 2
#sample_retract_dist: 10.0
#samples_result: average
#samples_tolerance: 0.100
#samples_tolerance_retries: 2

#[safe_z_home]
#home_xy_position: 147, 154
#speed: 80
#z_hop: 15
#z_hop_speed: 5



[delayed_gcode bed_mesh_init]
initial_duration: .01
gcode:
  BED_MESH_PROFILE LOAD=default

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
#position_max: 255. # before chatgpt
#position_min: -15. # before chatgpt
position_min: 0
#position_max: 235
position_max: 255
homing_speed: 40
#endstop_pin: tmc2209_stepper_x:virtual_endstop
#homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.800
#diag_pin: ^PA1
#driver_SGTHRS: 255
#hold_current: 0.500
#run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
#position_max: 232  # before chatgpt
position_max: 235
position_min: 0
homing_speed: 40

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
#run_current: 0.580
#hold_current: 0.500
run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_max: 250
position_min: -5

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.600
#hold_current: 0.580
stealthchop_threshold: 999999

[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD1
microsteps: 16
gear_ratio: 42:12
#rotation_distance: 24.0
rotation_distance: 26.359
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
min_temp: -100
max_temp: 300
max_extrude_only_distance: 150.0
max_extrude_cross_section: 5

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650
hold_current: 0.500
#stealthchop_threshold: 999999

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC4
min_temp: 0
max_temp: 130

[heater_fan controller_fan]
pin: PC7
heater: heater_bed
heater_temp: 45.0

[heater_fan nozzle_cooling_fan]
pin: PB15

[fan]
pin: PC6
max_power: 0.7

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_3E0011000350415339373620-if00

[printer]
kinematics: cartesian
max_velocity: 500
#max_accel: 13000
max_accel: 11000
max_z_velocity: 20
max_z_accel: 200

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.325
#*# pid_ki = 0.849
#*# pid_kd = 88.355
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 66.505
#*# pid_ki = 0.979
#*# pid_kd = 1129.755
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.033727, -0.035484, -0.032797, -0.023673, -0.021387, -0.009731, -0.006959, -0.000008, -0.003323, -0.002990, 0.002386, -0.010239, -0.010455, -0.009941, -0.025990, -0.034354, -0.035424, -0.040099, -0.038984, -0.059229, -0.071883, -0.084213, -0.101095, -0.105462, -0.125132
#*# 	  -0.029903, -0.023047, -0.015783, -0.012738, -0.003214, 0.010227, 0.011757, 0.017630, 0.014527, 0.018706, 0.019736, 0.012953, 0.015890, 0.012474, -0.001606, -0.012661, -0.016648, -0.022737, -0.029424, -0.045755, -0.065435, -0.081281, -0.094784, -0.077034, -0.106972
#*# 	  -0.050870, -0.015803, -0.017088, -0.014587, -0.010601, -0.008223, -0.001153, 0.002857, 0.005007, 0.004819, 0.002049, -0.007214, -0.003658, 0.001593, -0.013588, -0.029530, -0.043107, -0.040579, -0.041693, -0.065165, -0.081005, -0.097680, -0.102276, -0.104530, -0.123701
#*# 	  -0.033424, -0.021255, -0.013542, -0.002919, -0.006185, 0.006628, 0.015123, 0.016484, 0.017270, 0.021779, 0.023926, 0.020206, 0.016278, 0.014128, 0.002676, -0.006915, -0.017044, -0.015116, -0.024119, -0.051237, -0.067394, -0.080539, -0.083095, -0.077436, -0.116435
#*# 	  -0.042380, -0.009123, -0.012559, -0.002511, -0.005279, 0.002706, 0.010919, 0.007998, 0.016471, 0.010269, 0.008906, 0.006687, 0.000486, 0.002015, -0.012109, -0.017506, -0.025645, -0.026525, -0.040916, -0.056520, -0.070478, -0.079692, -0.091426, -0.102525, -0.113321
#*# 	  -0.021412, -0.010406, -0.003163, 0.008160, 0.010882, 0.023421, 0.028668, 0.031193, 0.042493, 0.029122, 0.041396, 0.036665, 0.031487, 0.024442, 0.015641, 0.002544, -0.001759, -0.001925, -0.018842, -0.033747, -0.053306, -0.066031, -0.076208, -0.068497, -0.099446
#*# 	  -0.028309, 0.002394, 0.003922, 0.016948, 0.015324, 0.018379, 0.023172, 0.029046, 0.032895, 0.026610, 0.026158, 0.022270, 0.018551, 0.019406, 0.007959, -0.005801, -0.006999, -0.016826, -0.029812, -0.038423, -0.054370, -0.068832, -0.090204, -0.092715, -0.107868
#*# 	  -0.012469, -0.000526, 0.013522, 0.026611, 0.027519, 0.035937, 0.045080, 0.043423, 0.050607, 0.047491, 0.051760, 0.051838, 0.040658, 0.043271, 0.025626, 0.025697, 0.016038, 0.001369, -0.011621, -0.020700, -0.041519, -0.052951, -0.060569, -0.074712, -0.096748
#*# 	  -0.021293, 0.009059, 0.017721, 0.021274, 0.024827, 0.023632, 0.030378, 0.033804, 0.036718, 0.030550, 0.032625, 0.030378, 0.031812, 0.026948, 0.007659, -0.003764, -0.005762, -0.017593, -0.029403, -0.046998, -0.059705, -0.069599, -0.086740, -0.098242, -0.112885
#*# 	  -0.008835, -0.000160, 0.012927, 0.020960, 0.025252, 0.028159, 0.043686, 0.044466, 0.040423, 0.046424, 0.041274, 0.045363, 0.035623, 0.034843, 0.021317, 0.010257, 0.005964, -0.010233, -0.021921, -0.033137, -0.051233, -0.063392, -0.086006, -0.083636, -0.104849
#*# 	  -0.018552, 0.009542, 0.011427, 0.016836, 0.018075, 0.020675, 0.023893, 0.035772, 0.032524, 0.028025, 0.027904, 0.022040, 0.024971, 0.022399, 0.009102, -0.010097, -0.021655, -0.027091, -0.029189, -0.056293, -0.070743, -0.083188, -0.094434, -0.096499, -0.122852
#*# 	  -0.000283, 0.005746, 0.011438, 0.017424, 0.027958, 0.034262, 0.035616, 0.039308, 0.043569, 0.046132, 0.043187, 0.038522, 0.032346, 0.035737, 0.018767, 0.000221, -0.000067, -0.010404, -0.019008, -0.039330, -0.063255, -0.066855, -0.089834, -0.079804, -0.111457
#*# 	  -0.011097, 0.016068, 0.017430, 0.018157, 0.018258, 0.029143, 0.029077, 0.032576, 0.032703, 0.035930, 0.029452, 0.027140, 0.024540, 0.022228, 0.007569, -0.010229, -0.017121, -0.016949, -0.029832, -0.048753, -0.065993, -0.082238, -0.090461, -0.093889, -0.117667
#*# 	  0.002164, 0.019742, 0.026055, 0.022672, 0.034558, 0.037039, 0.045034, 0.051811, 0.049854, 0.056853, 0.051032, 0.049250, 0.044807, 0.044791, 0.028347, 0.015262, 0.010472, -0.000800, -0.005090, -0.025284, -0.050755, -0.059552, -0.076964, -0.071676, -0.106375
#*# 	  -0.004243, 0.025958, 0.030083, 0.029793, 0.034547, 0.039938, 0.050975, 0.051578, 0.053233, 0.049495, 0.044309, 0.041097, 0.048872, 0.034835, 0.019471, 0.006678, -0.003513, 0.002292, -0.017706, -0.033145, -0.047903, -0.067629, -0.073597, -0.093140, -0.112270
#*# 	  0.013348, 0.026965, 0.038605, 0.044728, 0.047619, 0.055141, 0.060308, 0.070221, 0.066352, 0.064046, 0.072182, 0.061142, 0.070229, 0.059361, 0.045112, 0.028692, 0.019405, 0.018616, 0.007063, -0.014510, -0.037005, -0.052012, -0.065175, -0.064514, -0.091397
#*# 	  0.008077, 0.027182, 0.044700, 0.057391, 0.056039, 0.049217, 0.056936, 0.067925, 0.059862, 0.055934, 0.055154, 0.061150, 0.055882, 0.046672, 0.033198, 0.030129, 0.014898, 0.014234, -0.003695, -0.019168, -0.029051, -0.047920, -0.061228, -0.079225, -0.094621
#*# 	  0.021283, 0.035874, 0.052424, 0.062280, 0.062713, 0.061234, 0.069359, 0.084828, 0.078000, 0.068044, 0.068370, 0.077371, 0.084378, 0.066614, 0.048982, 0.046507, 0.042643, 0.033913, 0.013512, -0.009096, -0.014837, -0.034031, -0.049388, -0.065842, -0.068574
#*# 	  0.014971, 0.034395, 0.048131, 0.057511, 0.058990, 0.052344, 0.062075, 0.070826, 0.067641, 0.057736, 0.054475, 0.057561, 0.058562, 0.048005, 0.032191, 0.027190, 0.022449, 0.021498, -0.003294, -0.020096, -0.023603, -0.042119, -0.062481, -0.080416, -0.096260
#*# 	  0.011765, 0.026690, 0.039429, 0.045769, 0.045712, 0.054136, 0.059649, 0.066643, 0.064736, 0.054580, 0.057664, 0.063004, 0.067565, 0.050718, 0.037511, 0.037293, 0.032111, 0.026617, 0.007971, -0.012704, -0.016208, -0.036991, -0.048204, -0.060018, -0.070900
#*# 	  -0.000563, 0.014140, 0.032208, 0.041979, 0.047191, 0.039072, 0.048273, 0.049965, 0.044801, 0.043546, 0.038159, 0.039415, 0.039637, 0.035777, 0.020103, 0.011050, 0.009963, 0.005880, -0.010501, -0.029498, -0.041933, -0.049156, -0.065576, -0.082232, -0.100509
#*# 	  0.008515, 0.014463, 0.028491, 0.034429, 0.042323, 0.051790, 0.058204, 0.057426, 0.059508, 0.055683, 0.057462, 0.056382, 0.056684, 0.053778, 0.036709, 0.026705, 0.024109, 0.024608, 0.009024, -0.009278, -0.018711, -0.026544, -0.037569, -0.055330, -0.061928
#*# 	  0.016058, 0.029622, 0.038780, 0.044933, 0.047013, 0.049142, 0.052225, 0.063076, 0.052225, 0.058589, 0.056936, 0.050520, 0.049116, 0.045309, 0.040537, 0.025843, 0.020321, 0.020774, 0.009686, -0.005567, -0.018505, -0.027779, -0.043718, -0.051638, -0.076077
#*# 	  0.023354, 0.035105, 0.049346, 0.050650, 0.069450, 0.075464, 0.073660, 0.081590, 0.079892, 0.080431, 0.079762, 0.071959, 0.073918, 0.079492, 0.064177, 0.049291, 0.041475, 0.048291, 0.037573, 0.018907, 0.003321, -0.002367, -0.008962, -0.021232, -0.027779
#*# 	  0.017664, 0.046248, 0.056499, 0.061538, 0.066270, 0.066795, 0.069353, 0.075345, 0.072683, 0.077010, 0.073441, 0.070944, 0.073623, 0.065280, 0.062022, 0.047611, 0.041773, 0.042551, 0.034608, 0.026399, 0.006122, -0.000682, -0.008823, -0.010989, -0.015135
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 213.35999999999999
#*# min_y = 30.0
#*# max_y = 193.9200000000001
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3236264.727,0.090000:3235487.083,0.130000:3234672.128,
#*# 	0.170000:3233891.446,0.210000:3233073.086,0.250000:3232293.334,
#*# 	0.290000:3231463.762,0.330000:3230741.031,0.370000:3229937.802,
#*# 	0.410000:3229183.794,0.450000:3228442.705,0.490000:3227746.833,
#*# 	0.530000:3227003.344,0.570000:3226285.404,0.610000:3225564.657,
#*# 	0.650000:3224921.949,0.690000:3224191.191,0.730000:3223522.203,
#*# 	0.770000:3222831.424,0.810000:3222238.861,0.850000:3221550.988,
#*# 	0.890000:3220940.047,0.930000:3220325.190,0.970000:3219718.352,
#*# 	1.010000:3219151.778,1.050000:3218540.928,1.090000:3217973.460,
#*# 	1.130000:3217439.369,1.170000:3216856.595,1.210000:3216331.047,
#*# 	1.250000:3215795.690,1.290000:3215272.488,1.330000:3214717.109,
#*# 	1.370000:3214232.116,1.410000:3213705.698,1.450000:3213201.393,
#*# 	1.490000:3212727.329,1.530000:3212254.189,1.570000:3211791.347,
#*# 	1.610000:3211329.983,1.650000:3210871.178,1.690000:3210396.735,
#*# 	1.730000:3209937.378,1.770000:3209489.145,1.810000:3209068.507,
#*# 	1.850000:3208651.255,1.890000:3208204.583,1.930000:3207790.412,
#*# 	1.970000:3207359.195,2.010000:3206980.198,2.050000:3206582.861,
#*# 	2.090000:3206194.319,2.130000:3205793.363,2.170000:3205425.104,
#*# 	2.210000:3205047.378,2.250000:3204713.371,2.290000:3204339.815,
#*# 	2.330000:3203983.505,2.370000:3203638.252,2.410000:3203309.326,
#*# 	2.450000:3202963.682,2.490000:3202646.334,2.530000:3202311.718,
#*# 	2.570000:3202017.188,2.610000:3201713.380,2.650000:3201410.247,
#*# 	2.690000:3201097.977,2.730000:3200815.672,2.770000:3200523.223,
#*# 	2.810000:3200259.814,2.850000:3199952.498,2.890000:3199681.470,
#*# 	2.930000:3199394.122,2.970000:3199150.697,3.010000:3198891.535,
#*# 	3.050000:3198632.808,3.090000:3198382.088,3.130000:3198142.085,
#*# 	3.170000:3197898.873,3.210000:3197675.297,3.250000:3197454.021,
#*# 	3.290000:3197203.746,3.330000:3196987.418,3.370000:3196768.758,
#*# 	3.410000:3196549.678,3.450000:3196328.144,3.490000:3196119.478,
#*# 	3.530000:3195925.643,3.570000:3195722.646,3.610000:3195504.420,
#*# 	3.650000:3195307.639,3.690000:3195130.600,3.730000:3194936.264,
#*# 	3.770000:3194751.216,3.810000:3194544.559,3.850000:3194354.947,
#*# 	3.890000:3194188.777,3.930000:3194009.852,3.970000:3193840.600,
#*# 	4.010000:3193651.015,4.050000:3193499.699
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 38.301728
#*# drift_calibration =
#*# 	3284875.109965, -1546.648422, 13.055891
#*# 	3269431.818577, -1226.125720, 10.042791
#*# 	3256243.901966, -955.082307, 7.573431
#*# 	3243808.214668, -684.064278, 5.137474
#*# 	3233092.659756, -447.425000, 3.013868
#*# 	3224135.994453, -251.407288, 1.250156
#*# 	3217922.470009, -140.090710, 0.304005
#*# 	3212070.507564, -20.046518, -0.745995
#*# 	3207412.588163, 76.051519, -1.637191
#*# drift_calibration_min_temp = 39.103461654920906
