# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v3.0. To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication/USART.

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.

# See docs/Config_Reference.md for a description of parameters.
#[bltouch]
#sensor_pin: PC14
#control_pin: PA1
#x_offset: -40
#y_offset: -10
#z_offset: 3.0
#speed:
#[include Adxl345.cfg]
[include fluidd.cfg]
[include macro.cfg]
[include mainsail.cfg]
[include eddy.cfg]
#[include moonraker.conf]
[exclude_object]

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 60.4
shaper_type_y = mzv
shaper_freq_y = 38.2

#[bltouch]
#sensor_pin: ^PC14
#control_pin: PA1
#x_offset: -31.8
#y_offset: -47.0
#speed: 300
#samples: 2
#sample_retract_dist: 10.0
#samples_result: average
#samples_tolerance: 0.100
#samples_tolerance_retries: 2

#[safe_z_home]
#home_xy_position: 147, 154
#speed: 80
#z_hop: 15
#z_hop_speed: 5



[delayed_gcode bed_mesh_init]
initial_duration: .01
gcode:
  BED_MESH_PROFILE LOAD=default

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
#position_max: 255. # before chatgpt
#position_min: -15. # before chatgpt
position_min: 0
#position_max: 235
position_max: 255
homing_speed: 40
#endstop_pin: tmc2209_stepper_x:virtual_endstop
#homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.800
#diag_pin: ^PA1
#driver_SGTHRS: 255
#hold_current: 0.500
#run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
#position_max: 232  # before chatgpt
position_max: 235
position_min: 0
homing_speed: 40

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
#run_current: 0.580
#hold_current: 0.500
run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_max: 250
position_min: -5

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.600
#hold_current: 0.580
stealthchop_threshold: 999999

[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD1
microsteps: 16
gear_ratio: 42:12
#rotation_distance: 24.0
rotation_distance: 26.359
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
min_temp: -100
max_temp: 300
max_extrude_only_distance: 150.0
max_extrude_cross_section: 5

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650
hold_current: 0.500
#stealthchop_threshold: 999999

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC4
min_temp: 0
max_temp: 130

[heater_fan controller_fan]
pin: PC7
heater: heater_bed
heater_temp: 45.0

[heater_fan nozzle_cooling_fan]
pin: PB15

[fan]
pin: PC6
max_power: 0.7

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_3E0011000350415339373620-if00

[printer]
kinematics: cartesian
max_velocity: 500
#max_accel: 13000
max_accel: 11000
max_z_velocity: 20
max_z_accel: 200

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.325
#*# pid_ki = 0.849
#*# pid_kd = 88.355
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 66.505
#*# pid_ki = 0.979
#*# pid_kd = 1129.755
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.012817, 0.015840, 0.017155, 0.028814, 0.024291, 0.036828, 0.039443, 0.034869, 0.038878, 0.036224, 0.036419, 0.023005, 0.015002, 0.018636, -0.003829, -0.012175, -0.024772, -0.042922, -0.057963, -0.076744, -0.102784, -0.128093, -0.159314, -0.163753, -0.185861
#*# 	  0.022138, 0.028853, 0.033370, 0.037918, 0.044386, 0.048568, 0.055430, 0.053142, 0.057691, 0.054469, 0.059045, 0.050119, 0.036984, 0.035319, 0.026892, 0.018442, 0.006327, 0.001794, -0.013004, -0.025172, -0.044338, -0.067221, -0.090854, -0.103527, -0.133483
#*# 	  -0.001441, 0.041730, 0.040968, 0.041166, 0.039640, 0.046108, 0.044754, 0.046476, 0.052577, 0.040402, 0.042664, 0.037154, 0.029915, 0.026894, 0.012848, 0.000312, -0.014845, -0.020805, -0.034863, -0.050568, -0.067437, -0.093526, -0.115401, -0.124603, -0.152175
#*# 	  0.009152, 0.021912, 0.028854, 0.041901, 0.042493, 0.042860, 0.050854, 0.052379, 0.053510, 0.048199, 0.051813, 0.051814, 0.047607, 0.037944, 0.032582, 0.019116, 0.005068, 0.004396, -0.012585, -0.029898, -0.041481, -0.058810, -0.085588, -0.095961, -0.139729
#*# 	  0.010440, 0.036985, 0.038141, 0.049356, 0.048961, 0.048764, 0.049132, 0.051815, 0.060571, 0.053905, 0.048396, 0.041758, 0.035846, 0.040376, 0.018892, 0.001345, -0.004249, -0.015460, -0.031579, -0.048074, -0.064707, -0.082422, -0.110294, -0.123386, -0.155288
#*# 	  0.015421, 0.024516, 0.035854, 0.051446, 0.055205, 0.054075, 0.055354, 0.064921, 0.068734, 0.065119, 0.064356, 0.057323, 0.056928, 0.050854, 0.040573, 0.026669, 0.027536, 0.015420, -0.006851, -0.016499, -0.039212, -0.053734, -0.083293, -0.093735, -0.124183
#*# 	  0.022779, 0.050657, 0.052380, 0.062293, 0.057717, 0.057888, 0.060346, 0.062700, 0.064186, 0.068009, 0.056362, 0.053680, 0.052943, 0.048594, 0.037523, 0.021045, 0.008958, -0.006434, -0.018554, -0.032193, -0.058157, -0.077372, -0.101301, -0.114579, -0.147287
#*# 	  0.022362, 0.045516, 0.045149, 0.059978, 0.068169, 0.064186, 0.071652, 0.070269, 0.078210, 0.075416, 0.076621, 0.072858, 0.068367, 0.062964, 0.052379, 0.041901, 0.037157, 0.023200, 0.006356, -0.010121, -0.034462, -0.049729, -0.071668, -0.083485, -0.136136
#*# 	  0.029720, 0.060543, 0.059046, 0.061899, 0.068339, 0.066446, 0.067405, 0.068536, 0.070858, 0.074209, 0.067406, 0.061871, 0.060740, 0.052945, 0.048199, 0.020756, 0.013267, -0.004473, -0.010522, -0.033020, -0.056464, -0.074833, -0.094344, -0.110691, -0.147966
#*# 	  0.036419, 0.043191, 0.049894, 0.063029, 0.072063, 0.074445, 0.071856, 0.074386, 0.075593, 0.083120, 0.077592, 0.071445, 0.065512, 0.062436, 0.052379, 0.032410, 0.035066, 0.021299, 0.008034, -0.019809, -0.032807, -0.044364, -0.080128, -0.092705, -0.140599
#*# 	  0.041731, 0.068338, 0.065684, 0.069891, 0.066841, 0.069497, 0.073445, 0.068367, 0.073239, 0.071622, 0.070858, 0.061136, 0.056758, 0.051985, 0.038680, 0.015451, 0.010470, -0.004503, -0.014230, -0.034649, -0.060888, -0.078627, -0.104768, -0.116431, -0.156408
#*# 	  0.039837, 0.059215, 0.051616, 0.063790, 0.069694, 0.074798, 0.076946, 0.073240, 0.074798, 0.075416, 0.078798, 0.077593, 0.065119, 0.058084, 0.047437, 0.040600, 0.035631, 0.018248, 0.011307, -0.025788, -0.037343, -0.052671, -0.083293, -0.085396, -0.143710
#*# 	  0.040968, 0.062266, 0.075622, 0.077798, 0.064356, 0.074800, 0.076976, 0.077454, 0.081915, 0.076444, 0.071828, 0.064750, 0.056560, 0.054102, 0.039443, 0.028629, 0.010246, 0.002437, -0.016473, -0.028056, -0.052671, -0.074230, -0.096593, -0.112543, -0.153732
#*# 	  0.049158, 0.065684, 0.064553, 0.074034, 0.081944, 0.086296, 0.087816, 0.085488, 0.083534, 0.086503, 0.087438, 0.079063, 0.071651, 0.069299, 0.060344, 0.050091, 0.037945, 0.030123, 0.013267, -0.004893, -0.024559, -0.049328, -0.068912, -0.081600, -0.121535
#*# 	  0.052944, 0.081739, 0.081689, 0.085785, 0.080181, 0.083945, 0.084117, 0.091013, 0.086881, 0.083943, 0.082150, 0.080974, 0.073240, 0.066051, 0.056587, 0.046306, 0.030518, 0.019310, -0.002934, -0.022505, -0.030940, -0.061759, -0.076526, -0.103127, -0.127274
#*# 	  0.061135, 0.069064, 0.082151, 0.085253, 0.084073, 0.095641, 0.097995, 0.095435, 0.104791, 0.093867, 0.102024, 0.098507, 0.088127, 0.083945, 0.073622, 0.067801, 0.056165, 0.047832, 0.035092, 0.013042, -0.009903, -0.039825, -0.058810, -0.072104, -0.103525
#*# 	  0.070888, 0.085739, 0.090247, 0.099259, 0.090625, 0.101613, 0.100014, 0.102173, 0.094529, 0.085141, 0.098066, 0.090430, 0.084914, 0.084709, 0.069892, 0.062859, 0.044584, 0.030123, 0.010246, -0.004698, -0.021037, -0.041882, -0.070000, -0.092519, -0.134375
#*# 	  0.071858, 0.080180, 0.085844, 0.089187, 0.096191, 0.105898, 0.104348, 0.103920, 0.108835, 0.104533, 0.099723, 0.098590, 0.096002, 0.088762, 0.084122, 0.074622, 0.073446, 0.055627, 0.040035, 0.018219, 0.003081, -0.023946, -0.044550, -0.066069, -0.091252
#*# 	  0.071269, 0.086297, 0.096005, 0.093446, 0.091122, 0.100920, 0.094813, 0.106572, 0.101563, 0.095688, 0.091791, 0.086886, 0.086296, 0.080385, 0.069694, 0.060938, 0.053905, 0.037354, 0.018249, -0.006404, -0.022690, -0.040039, -0.074012, -0.088562, -0.128141
#*# 	  0.066249, 0.075827, 0.079975, 0.085366, 0.093394, 0.094557, 0.094181, 0.095168, 0.098688, 0.098001, 0.092299, 0.095062, 0.086829, 0.091338, 0.072652, 0.066841, 0.062633, 0.055034, 0.043058, 0.015226, -0.002740, -0.024133, -0.050977, -0.068091, -0.099847
#*# 	  0.062700, 0.079181, 0.089105, 0.081151, 0.088347, 0.087387, 0.088756, 0.086885, 0.088154, 0.095165, 0.087543, 0.078386, 0.075034, 0.069892, 0.064723, 0.048396, 0.038485, 0.017286, 0.014329, -0.006433, -0.029686, -0.043537, -0.075486, -0.092307, -0.128702
#*# 	  0.056362, 0.069893, 0.070063, 0.080563, 0.084990, 0.092234, 0.089702, 0.098721, 0.085426, 0.096771, 0.088365, 0.087988, 0.082944, 0.085708, 0.071064, 0.057691, 0.056927, 0.047239, 0.045451, 0.019760, -0.000024, -0.015245, -0.043111, -0.048073, -0.080345
#*# 	  0.067943, 0.082563, 0.084762, 0.087117, 0.083827, 0.103780, 0.095548, 0.097904, 0.089876, 0.096171, 0.088927, 0.085534, 0.079768, 0.079386, 0.077455, 0.057349, 0.046475, 0.038877, 0.019983, 0.003558, -0.017940, -0.023518, -0.045617, -0.069373, -0.108045
#*# 	  0.067802, 0.084914, 0.085164, 0.092212, 0.104179, 0.107701, 0.107833, 0.107597, 0.109169, 0.110338, 0.102707, 0.097818, 0.102593, 0.097298, 0.092820, 0.083739, 0.073445, 0.070447, 0.063790, 0.038878, 0.022810, 0.019040, -0.008615, -0.014506, -0.052260
#*# 	  0.076797, 0.096047, 0.095466, 0.101693, 0.105046, 0.102687, 0.107781, 0.112467, 0.105627, 0.106005, 0.103095, 0.098286, 0.105736, 0.088653, 0.085917, 0.073034, 0.075181, 0.067576, 0.049893, 0.035065, 0.021045, 0.003754, -0.016473, -0.035476, -0.050569
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 213.35999999999999
#*# min_y = 30.0
#*# max_y = 193.9200000000001
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3249588.915,0.090000:3248719.257,0.130000:3247760.459,
#*# 	0.170000:3246889.736,0.210000:3245960.568,0.250000:3245104.587,
#*# 	0.290000:3244126.832,0.330000:3243239.384,0.370000:3242301.907,
#*# 	0.410000:3241447.045,0.450000:3240543.379,0.490000:3239683.546,
#*# 	0.530000:3238777.045,0.570000:3237927.385,0.610000:3237031.646,
#*# 	0.650000:3236191.131,0.690000:3235309.394,0.730000:3234475.911,
#*# 	0.770000:3233656.749,0.810000:3232832.333,0.850000:3232019.884,
#*# 	0.890000:3231239.714,0.930000:3230450.250,0.970000:3229677.964,
#*# 	1.010000:3228912.743,1.050000:3228181.679,1.090000:3227414.419,
#*# 	1.130000:3226742.526,1.170000:3225983.967,1.210000:3225287.042,
#*# 	1.250000:3224592.113,1.290000:3223917.099,1.330000:3223217.338,
#*# 	1.370000:3222575.369,1.410000:3221904.764,1.450000:3221274.406,
#*# 	1.490000:3220632.724,1.530000:3219990.701,1.570000:3219387.550,
#*# 	1.610000:3218803.258,1.650000:3218204.364,1.690000:3217604.803,
#*# 	1.730000:3217059.259,1.770000:3216505.623,1.810000:3215962.345,
#*# 	1.850000:3215399.835,1.890000:3214860.036,1.930000:3214335.362,
#*# 	1.970000:3213829.990,2.010000:3213332.934,2.050000:3212810.798,
#*# 	2.090000:3212335.265,2.130000:3211852.524,2.170000:3211381.270,
#*# 	2.210000:3210893.213,2.250000:3210460.208,2.290000:3209998.893,
#*# 	2.330000:3209560.398,2.370000:3209126.212,2.410000:3208697.142,
#*# 	2.450000:3208282.894,2.490000:3207873.430,2.530000:3207460.295,
#*# 	2.570000:3207075.057,2.610000:3206678.180,2.650000:3206286.861,
#*# 	2.690000:3205904.521,2.730000:3205547.389,2.770000:3205173.288,
#*# 	2.810000:3204825.394,2.850000:3204462.722,2.890000:3204112.563,
#*# 	2.930000:3203753.541,2.970000:3203437.641,3.010000:3203122.573,
#*# 	3.050000:3202779.184,3.090000:3202488.361,3.130000:3202173.311,
#*# 	3.170000:3201861.320,3.210000:3201578.257,3.250000:3201246.902,
#*# 	3.290000:3200968.765,3.330000:3200674.471,3.370000:3200407.323,
#*# 	3.410000:3200135.815,3.450000:3199834.956,3.490000:3199558.112,
#*# 	3.530000:3199299.595,3.570000:3199029.187,3.610000:3198773.437,
#*# 	3.650000:3198527.876,3.690000:3198273.160,3.730000:3198044.500,
#*# 	3.770000:3197817.163,3.810000:3197580.963,3.850000:3197337.359,
#*# 	3.890000:3197114.192,3.930000:3196897.225,3.970000:3196662.424,
#*# 	4.010000:3196479.973,4.050000:3196254.008
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 37.334856
#*# drift_calibration =
#*# 	3284875.109965, -1546.648422, 13.055891
#*# 	3269431.818577, -1226.125720, 10.042791
#*# 	3256243.901966, -955.082307, 7.573431
#*# 	3243808.214668, -684.064278, 5.137474
#*# 	3233092.659756, -447.425000, 3.013868
#*# 	3224135.994453, -251.407288, 1.250156
#*# 	3217922.470009, -140.090710, 0.304005
#*# 	3212070.507564, -20.046518, -0.745995
#*# 	3207412.588163, 76.051519, -1.637191
#*# drift_calibration_min_temp = 39.103461654920906
