# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v3.0. To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication/USART.

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.

# See docs/Config_Reference.md for a description of parameters.
#[bltouch]
#sensor_pin: PC14
#control_pin: PA1
#x_offset: -40
#y_offset: -10
#z_offset: 3.0
#speed:
#[include Adxl345.cfg]
[include fluidd.cfg]
[include macro.cfg]
[include mainsail.cfg]
[include eddy.cfg]
#[include moonraker.conf]
[exclude_object]

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 60.4
shaper_type_y = mzv
shaper_freq_y = 38.2

#[bltouch]
#sensor_pin: ^PC14
#control_pin: PA1
#x_offset: -31.8
#y_offset: -47.0
#speed: 300
#samples: 2
#sample_retract_dist: 10.0
#samples_result: average
#samples_tolerance: 0.100
#samples_tolerance_retries: 2

#[safe_z_home]
#home_xy_position: 147, 154
#speed: 80
#z_hop: 15
#z_hop_speed: 5



[delayed_gcode bed_mesh_init]
initial_duration: .01
gcode:
  BED_MESH_PROFILE LOAD=default

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
#position_max: 255. # before chatgpt
#position_min: -15. # before chatgpt
position_min: 0
#position_max: 235
position_max: 255
homing_speed: 40
#endstop_pin: tmc2209_stepper_x:virtual_endstop
#homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.800
#diag_pin: ^PA1
#driver_SGTHRS: 255
#hold_current: 0.500
#run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
#position_max: 232  # before chatgpt
position_max: 235
position_min: 0
homing_speed: 40

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
#run_current: 0.580
#hold_current: 0.500
run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_max: 250
position_min: -5

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.600
#hold_current: 0.580
stealthchop_threshold: 999999

[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD1
microsteps: 16
gear_ratio: 42:12
#rotation_distance: 24.0
rotation_distance: 26.359
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
min_temp: -100
max_temp: 300
max_extrude_only_distance: 150.0
max_extrude_cross_section: 5

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650
hold_current: 0.500
#stealthchop_threshold: 999999

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC4
min_temp: 0
max_temp: 130

[heater_fan controller_fan]
pin: PC7
heater: heater_bed
heater_temp: 45.0

[heater_fan nozzle_cooling_fan]
pin: PB15

[fan]
pin: PC6
max_power: 0.7

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_3E0011000350415339373620-if00

[printer]
kinematics: cartesian
max_velocity: 500
#max_accel: 13000
max_accel: 11000
max_z_velocity: 20
max_z_accel: 200

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.325
#*# pid_ki = 0.849
#*# pid_kd = 88.355
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 66.505
#*# pid_ki = 0.979
#*# pid_kd = 1129.755
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.037398, -0.029133, -0.025485, -0.017069, -0.009252, 0.010301, 0.014625, 0.022740, 0.025108, 0.021658, 0.023511, 0.021042, 0.022136, 0.022136, 0.015512, -0.004384, 0.004370, 0.004216, -0.008103, -0.016147, -0.034614, -0.036999, -0.050568, -0.042936, -0.059317
#*# 	-0.041122, -0.022850, -0.022564, -0.010132, -0.001427, 0.004444, 0.013201, 0.022061, 0.018713, 0.025656, 0.018651, 0.017312, 0.020865, 0.022308, 0.006391, -0.007073, -0.010059, -0.009648, -0.011175, -0.031829, -0.044360, -0.040602, -0.055424, -0.032280, -0.067523
#*# 	-0.054209, -0.019503, -0.016832, -0.010133, -0.005345, 0.006301, 0.019130, 0.021833, 0.024203, 0.031648, 0.021526, 0.025028, 0.020701, 0.018093, 0.010061, -0.003737, 0.008207, -0.003737, -0.010172, -0.026147, -0.034970, -0.022490, -0.036946, -0.041920, -0.050091
#*# 	-0.043630, -0.032314, -0.022063, -0.011207, -0.002314, 0.001293, 0.017208, 0.016358, 0.025767, 0.024890, 0.021080, 0.030326, 0.019996, 0.021492, 0.013183, 0.000464, -0.000208, -0.001907, -0.005871, -0.023793, -0.042966, -0.041085, -0.043826, -0.036215, -0.059276
#*# 	-0.045047, -0.010735, -0.016318, -0.000802, 0.003198, 0.014862, 0.034223, 0.027230, 0.033457, 0.021983, 0.036623, 0.041742, 0.036384, 0.025848, 0.015852, 0.007176, 0.015882, 0.008721, 0.000839, -0.014702, -0.020333, -0.022180, -0.034323, -0.032545, -0.045687
#*# 	-0.045965, -0.027948, -0.014197, -0.002568, -0.002001, 0.010775, 0.025025, 0.030450, 0.031501, 0.032171, 0.033176, 0.039057, 0.033222, 0.032506, 0.020255, 0.005049, 0.011898, 0.011795, 0.000543, -0.013768, -0.030005, -0.023207, -0.030007, -0.023103, -0.052468
#*# 	-0.037801, -0.011200, 0.000509, 0.009060, 0.013591, 0.023686, 0.038102, 0.045994, 0.039920, 0.037098, 0.051636, 0.052676, 0.050669, 0.038423, 0.033115, 0.031824, 0.028719, 0.022384, 0.009146, 0.004300, -0.006569, -0.007030, -0.016945, -0.026489, -0.031058
#*# 	-0.037718, -0.022285, -0.009052, 0.005925, 0.012005, 0.016433, 0.035342, 0.038403, 0.037063, 0.035533, 0.042472, 0.048880, 0.045007, 0.036878, 0.027776, 0.018248, 0.026922, 0.019745, 0.005443, -0.003538, -0.013312, -0.020009, -0.025136, -0.021768, -0.046894
#*# 	-0.035927, -0.010511, 0.000863, 0.006219, 0.010700, 0.026870, 0.039249, 0.043553, 0.042023, 0.042884, 0.051252, 0.052926, 0.047236, 0.035414, 0.030583, 0.028051, 0.021714, 0.020477, 0.005201, -0.003869, -0.009276, -0.012890, -0.023899, -0.033745, -0.039917
#*# 	-0.032760, -0.020428, -0.010989, -0.002452, 0.003626, 0.017475, 0.024378, 0.036514, 0.033533, 0.030233, 0.040003, 0.038856, 0.040817, 0.032591, 0.026147, 0.017288, 0.013785, 0.011640, -0.001904, -0.011006, -0.025872, -0.027242, -0.037279, -0.032104, -0.065063
#*# 	-0.025655, -0.009149, -0.001679, 0.004399, 0.012847, 0.022120, 0.028272, 0.039257, 0.036481, 0.035859, 0.048394, 0.040932, 0.042817, 0.033966, 0.023812, 0.018763, 0.018918, 0.014127, 0.001143, -0.010289, -0.017600, -0.017042, -0.035366, -0.037359, -0.049810
#*# 	-0.029777, -0.016467, -0.009244, -0.001716, 0.002253, 0.013236, 0.016640, 0.026900, 0.032196, 0.033633, 0.040827, 0.037159, 0.036744, 0.027558, 0.022405, 0.011371, 0.010495, 0.007867, -0.005946, -0.015448, -0.026821, -0.028483, -0.050432, -0.034728, -0.060958
#*# 	-0.038004, -0.006717, -0.003580, 0.001626, 0.009820, 0.024303, 0.028531, 0.032273, 0.034338, 0.037544, 0.049796, 0.043911, 0.041181, 0.039553, 0.029151, 0.024819, 0.017498, 0.017033, 0.005775, -0.007565, -0.012580, -0.020451, -0.025630, -0.037310, -0.045440
#*# 	-0.029082, -0.018569, -0.005684, -0.000530, 0.009057, 0.022972, 0.025291, 0.030461, 0.034230, 0.036431, 0.045192, 0.041842, 0.041315, 0.045431, 0.028520, 0.021359, 0.018113, 0.021771, 0.015435, -0.001005, -0.017262, -0.025437, -0.037214, -0.022900, -0.046353
#*# 	-0.036189, -0.004423, 0.003308, 0.003711, 0.020202, 0.034156, 0.041573, 0.049804, 0.048416, 0.053972, 0.060431, 0.058724, 0.055312, 0.053972, 0.041676, 0.035359, 0.034450, 0.033637, 0.023257, 0.011567, 0.002659, -0.002382, -0.008514, -0.019701, -0.031478
#*# 	-0.023537, -0.004721, 0.001052, 0.012752, 0.022493, 0.033367, 0.035844, 0.046216, 0.050108, 0.050684, 0.057958, 0.050252, 0.058798, 0.064159, 0.044010, 0.040851, 0.039702, 0.036831, 0.029003, 0.010959, 0.003379, -0.006468, -0.020944, -0.006209, -0.039547
#*# 	-0.013538, 0.002442, 0.016256, 0.022081, 0.030977, 0.039287, 0.052311, 0.056428, 0.058919, 0.056716, 0.065231, 0.070593, 0.069491, 0.066140, 0.056420, 0.045168, 0.052781, 0.046135, 0.037132, 0.027367, 0.019786, 0.015094, 0.010555, 0.000904, -0.012843
#*# 	-0.020895, 0.004433, 0.018725, 0.027446, 0.033527, 0.034725, 0.050347, 0.051209, 0.055282, 0.061799, 0.052791, 0.063573, 0.068827, 0.068508, 0.059118, 0.042441, 0.052647, 0.045681, 0.039067, 0.019637, 0.014010, 0.005391, 0.001869, 0.006974, -0.013656
#*# 	-0.011336, -0.000587, 0.021341, 0.018658, 0.033457, 0.041986, 0.053724, 0.054346, 0.055257, 0.062733, 0.061439, 0.071025, 0.064813, 0.060213, 0.055757, 0.048810, 0.051732, 0.050007, 0.041514, 0.027542, 0.021128, 0.021249, 0.004551, 0.005307, -0.007517
#*# 	-0.029585, -0.010365, 0.001344, 0.006713, 0.016571, 0.023226, 0.038423, 0.042738, 0.039957, 0.043360, 0.044463, 0.055454, 0.046876, 0.051572, 0.045150, 0.042607, 0.041776, 0.037702, 0.032478, 0.022088, 0.014346, -0.001792, -0.005506, 0.010132, -0.011826
#*# 	-0.043289, -0.010899, 0.002198, 0.003747, 0.015773, 0.029142, 0.042506, 0.044229, 0.038195, 0.044709, 0.051943, 0.057690, 0.052695, 0.040484, 0.042351, 0.040294, 0.044985, 0.036845, 0.032509, 0.025995, 0.018773, 0.018514, 0.000305, -0.000452, -0.006384
#*# 	-0.046337, -0.023961, -0.013538, -0.003268, 0.005091, 0.020567, 0.026810, 0.034334, 0.035947, 0.033207, 0.042263, 0.050218, 0.043797, 0.042503, 0.042119, 0.035363, 0.033495, 0.033495, 0.032297, 0.031771, 0.020813, 0.008895, 0.000682, 0.021674, 0.005340
#*# 	-0.027724, -0.011364, 0.004253, 0.007402, 0.016796, 0.031781, 0.046732, 0.047197, 0.048236, 0.049691, 0.062681, 0.063159, 0.065173, 0.056736, 0.056023, 0.055736, 0.055257, 0.055064, 0.044999, 0.044494, 0.042770, 0.040564, 0.028935, 0.018763, 0.017061
#*# 	-0.037232, -0.014529, -0.004735, 0.010709, 0.017165, 0.027652, 0.037270, 0.042066, 0.047328, 0.050206, 0.057015, 0.061092, 0.063249, 0.064303, 0.058611, 0.056644, 0.058372, 0.056309, 0.051127, 0.054438, 0.045408, 0.041715, 0.033896, 0.052123, 0.039795
#*# 	-0.025830, -0.006349, 0.013253, 0.012466, 0.034733, 0.043273, 0.056755, 0.058194, 0.057665, 0.061549, 0.075652, 0.071958, 0.077139, 0.079201, 0.076612, 0.077649, 0.074338, 0.077361, 0.072501, 0.071222, 0.073049, 0.071467, 0.065950, 0.058467, 0.081443
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 213.35999999999999
#*# min_y = 30.0
#*# max_y = 193.9200000000001
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3253714.442,0.090000:3252789.152,0.130000:3251869.392,
#*# 	0.170000:3250940.872,0.210000:3250035.237,0.250000:3249103.707,
#*# 	0.290000:3248161.703,0.330000:3247270.729,0.370000:3246357.769,
#*# 	0.410000:3245430.660,0.450000:3244511.072,0.490000:3243630.724,
#*# 	0.530000:3242693.447,0.570000:3241785.241,0.610000:3240891.935,
#*# 	0.650000:3240034.191,0.690000:3239125.349,0.730000:3238240.045,
#*# 	0.770000:3237382.836,0.810000:3236535.537,0.850000:3235688.970,
#*# 	0.890000:3234860.826,0.930000:3234029.018,0.970000:3233216.185,
#*# 	1.010000:3232443.420,1.050000:3231651.248,1.090000:3230854.400,
#*# 	1.130000:3230099.451,1.170000:3229349.198,1.210000:3228586.131,
#*# 	1.250000:3227856.036,1.290000:3227117.312,1.330000:3226381.597,
#*# 	1.370000:3225671.423,1.410000:3224957.435,1.450000:3224299.377,
#*# 	1.490000:3223613.851,1.530000:3222939.594,1.570000:3222251.621,
#*# 	1.610000:3221636.368,1.650000:3221008.547,1.690000:3220369.116,
#*# 	1.730000:3219731.106,1.770000:3219162.106,1.810000:3218530.681,
#*# 	1.850000:3217962.188,1.890000:3217373.514,1.930000:3216846.961,
#*# 	1.970000:3216305.929,2.010000:3215744.329,2.050000:3215202.559,
#*# 	2.090000:3214693.839,2.130000:3214188.709,2.170000:3213663.252,
#*# 	2.210000:3213176.175,2.250000:3212710.555,2.290000:3212215.807,
#*# 	2.330000:3211758.156,2.370000:3211296.773,2.410000:3210852.122,
#*# 	2.450000:3210403.707,2.490000:3209972.963,2.530000:3209534.000,
#*# 	2.570000:3209127.873,2.610000:3208695.695,2.650000:3208286.896,
#*# 	2.690000:3207870.410,2.730000:3207467.556,2.770000:3207078.241,
#*# 	2.810000:3206714.185,2.850000:3206289.992,2.890000:3205939.295,
#*# 	2.930000:3205552.230,2.970000:3205200.480,3.010000:3204835.415,
#*# 	3.050000:3204524.979,3.090000:3204146.825,3.130000:3203810.521,
#*# 	3.170000:3203485.830,3.210000:3203160.558,3.250000:3202837.308,
#*# 	3.290000:3202506.604,3.330000:3202201.670,3.370000:3201899.403,
#*# 	3.410000:3201566.786,3.450000:3201300.387,3.490000:3200990.360,
#*# 	3.530000:3200735.038,3.570000:3200443.518,3.610000:3200172.219,
#*# 	3.650000:3199880.594,3.690000:3199622.402,3.730000:3199347.194,
#*# 	3.770000:3199086.390,3.810000:3198838.495,3.850000:3198596.313,
#*# 	3.890000:3198358.038,3.930000:3198130.134,3.970000:3197889.016,
#*# 	4.010000:3197671.831,4.050000:3197423.512
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 38.416133
#*# drift_calibration =
#*# 	3284875.109965, -1546.648422, 13.055891
#*# 	3269431.818577, -1226.125720, 10.042791
#*# 	3256243.901966, -955.082307, 7.573431
#*# 	3243808.214668, -684.064278, 5.137474
#*# 	3233092.659756, -447.425000, 3.013868
#*# 	3224135.994453, -251.407288, 1.250156
#*# 	3217922.470009, -140.090710, 0.304005
#*# 	3212070.507564, -20.046518, -0.745995
#*# 	3207412.588163, 76.051519, -1.637191
#*# drift_calibration_min_temp = 39.103461654920906
