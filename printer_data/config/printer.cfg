# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v3.0. To use this config, the firmware should be compiled for the
# STM32G0B1 with a "8KiB bootloader" and USB communication/USART.

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.

# See docs/Config_Reference.md for a description of parameters.
#[bltouch]
#sensor_pin: PC14
#control_pin: PA1
#x_offset: -40
#y_offset: -10
#z_offset: 3.0
#speed:
#[include Adxl345.cfg]
[include fluidd.cfg]
[include macro.cfg]
[include mainsail.cfg]
[include eddy.cfg]
#[include moonraker.conf]
[exclude_object]

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 60.4
shaper_type_y = mzv
shaper_freq_y = 38.2

#[bltouch]
#sensor_pin: ^PC14
#control_pin: PA1
#x_offset: -31.8
#y_offset: -47.0
#speed: 300
#samples: 2
#sample_retract_dist: 10.0
#samples_result: average
#samples_tolerance: 0.100
#samples_tolerance_retries: 2

#[safe_z_home]
#home_xy_position: 147, 154
#speed: 80
#z_hop: 15
#z_hop_speed: 5



[delayed_gcode bed_mesh_init]
initial_duration: .01
gcode:
  BED_MESH_PROFILE LOAD=default

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
#position_max: 255. # before chatgpt
#position_min: -15. # before chatgpt
position_min: 0
#position_max: 235
position_max: 255
homing_speed: 40
#endstop_pin: tmc2209_stepper_x:virtual_endstop
#homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.800
#diag_pin: ^PA1
#driver_SGTHRS: 255
#hold_current: 0.500
#run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
#position_max: 232  # before chatgpt
position_max: 235
position_min: 0
homing_speed: 40

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
#run_current: 0.580
#hold_current: 0.500
run_current: 0.750
hold_current: 0.500
stealthchop_threshold: 999999

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
position_max: 250
position_min: -5

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.600
#hold_current: 0.580
stealthchop_threshold: 999999

[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD1
microsteps: 16
gear_ratio: 42:12
#rotation_distance: 24.0
rotation_distance: 26.359
nozzle_diameter: 0.400
filament_diameter: 1.750
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
heater_pin: PC8
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA0
min_temp: -100
max_temp: 300
max_extrude_only_distance: 150.0
max_extrude_cross_section: 5

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.650
hold_current: 0.500
#stealthchop_threshold: 999999

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC4
min_temp: 0
max_temp: 130

[heater_fan controller_fan]
pin: PC7
heater: heater_bed
heater_temp: 45.0

[heater_fan nozzle_cooling_fan]
pin: PB15

[fan]
pin: PC6
max_power: 0.7

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_3E0011000350415339373620-if00

[printer]
kinematics: cartesian
max_velocity: 500
#max_accel: 13000
max_accel: 11000
max_z_velocity: 20
max_z_accel: 200

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.325
#*# pid_ki = 0.849
#*# pid_kd = 88.355
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 66.505
#*# pid_ki = 0.979
#*# pid_kd = 1129.755
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.052003, -0.046393, -0.039694, -0.036344, -0.025552, -0.019912, -0.006900, -0.003712, -0.001045, 0.006804, 0.011010, 0.013418, 0.002400, 0.000175, -0.003950, -0.011855, -0.006724, -0.012937, -0.015475, -0.020846, -0.022868, -0.027768, -0.037541, -0.033554, -0.028613
#*# 	  -0.047783, -0.028325, -0.019764, -0.018282, -0.008339, 0.000074, 0.011826, 0.012997, 0.016444, 0.029309, 0.028768, 0.034954, 0.028768, 0.023174, 0.020399, 0.011683, 0.012632, 0.001861, 0.007345, -0.009667, -0.014281, -0.020818, -0.030521, -0.009751, -0.029031
#*# 	  -0.072382, -0.027086, -0.025605, -0.022413, -0.021557, -0.014389, 0.002670, 0.003831, 0.000905, 0.008643, 0.008600, 0.012849, 0.009803, 0.005813, 0.003192, -0.010410, -0.003072, -0.014882, -0.020004, -0.026069, -0.030270, -0.027394, -0.034087, -0.025050, -0.021825
#*# 	  -0.056542, -0.038076, -0.025737, -0.024593, -0.009405, -0.002946, 0.013569, 0.018489, 0.013872, 0.021738, 0.016970, 0.026247, 0.023154, 0.017945, 0.016559, 0.008877, 0.011088, 0.002006, -0.004715, -0.010790, -0.021199, -0.027892, -0.032408, -0.008603, -0.027309
#*# 	  -0.064419, -0.028397, -0.024568, -0.022356, -0.014377, -0.003403, 0.007828, 0.007937, 0.007825, 0.009970, 0.009818, 0.016796, 0.012436, 0.008383, 0.006434, -0.006591, 0.000691, -0.005052, -0.018361, -0.019762, -0.018780, -0.023850, -0.029376, -0.024861, -0.022430
#*# 	  -0.045039, -0.026999, -0.017738, -0.007061, 0.002890, 0.012947, 0.021096, 0.024738, 0.025194, 0.031891, 0.032579, 0.032891, 0.029683, 0.026131, 0.019216, 0.014433, 0.018745, 0.008762, 0.007824, -0.009555, -0.014592, -0.016747, -0.023284, -0.010792, -0.021375
#*# 	  -0.049700, -0.016841, -0.011358, 0.002850, 0.005213, 0.013410, 0.025468, 0.026480, 0.027499, 0.026784, 0.028367, 0.032417, 0.029603, 0.020575, 0.020238, 0.010287, 0.013107, 0.010699, -0.000181, -0.005446, -0.008767, -0.015727, -0.020937, -0.021836, -0.018491
#*# 	  -0.034607, -0.018734, -0.008785, 0.013113, 0.020380, 0.031034, 0.037232, 0.037654, 0.033991, 0.037720, 0.041028, 0.044025, 0.042027, 0.040918, 0.031363, 0.020919, 0.022197, 0.017432, 0.008922, -0.000347, -0.013025, -0.013565, -0.022232, -0.009951, -0.028427
#*# 	  -0.043951, -0.010100, -0.004916, 0.010001, 0.011086, 0.026929, 0.026820, 0.031444, 0.025968, 0.028170, 0.032873, 0.030508, 0.030284, 0.025199, 0.021861, 0.015626, 0.013783, 0.010140, -0.010770, -0.008118, -0.016299, -0.016268, -0.028924, -0.030205, -0.024990
#*# 	  -0.031754, -0.018408, -0.002460, 0.010613, 0.019847, 0.023490, 0.030105, 0.035962, 0.034696, 0.034961, 0.040657, 0.040895, 0.044664, 0.035931, 0.032307, 0.020788, 0.017407, 0.015563, -0.003974, -0.003713, -0.017417, -0.015236, -0.036449, -0.026293, -0.032116
#*# 	  -0.039620, -0.008179, -0.005230, 0.005436, 0.001273, 0.015107, 0.014543, 0.022240, 0.020745, 0.021569, 0.022847, 0.023544, 0.026471, 0.018514, 0.012920, 0.007696, 0.005637, -0.000324, -0.018195, -0.014179, -0.029447, -0.030145, -0.039361, -0.040800, -0.033129
#*# 	  -0.029157, -0.010067, -0.009471, 0.001388, 0.004772, 0.019200, 0.025662, 0.027092, 0.026378, 0.031034, 0.039662, 0.036128, 0.037395, 0.030335, 0.023339, 0.010673, 0.008056, 0.007115, -0.008362, -0.011382, -0.026063, -0.025322, -0.044522, -0.045006, -0.042711
#*# 	  -0.038837, -0.008772, -0.003284, 0.008278, 0.004678, 0.015046, 0.022469, 0.015960, 0.019908, 0.024009, 0.033771, 0.026048, 0.021188, 0.019401, 0.011698, 0.009593, 0.000459, -0.005855, -0.009458, -0.024436, -0.023537, -0.035927, -0.040674, -0.041616, -0.039056
#*# 	  -0.023317, -0.007413, -0.003880, 0.010937, 0.014167, 0.021033, 0.029040, 0.035297, 0.038343, 0.037228, 0.046010, 0.043807, 0.041964, 0.044698, 0.027083, 0.018777, 0.019861, 0.013702, 0.007848, -0.001020, -0.020898, -0.017404, -0.030917, -0.031344, -0.035841
#*# 	  -0.025654, -0.001820, -0.002183, 0.009159, 0.012390, 0.027115, 0.030246, 0.031415, 0.035287, 0.034908, 0.039955, 0.040800, 0.033596, 0.039066, 0.019369, 0.018392, 0.017307, 0.010234, 0.005874, -0.009483, -0.011219, -0.020955, -0.026015, -0.027769, -0.028555
#*# 	  -0.008245, 0.006530, 0.019829, 0.027729, 0.031212, 0.040312, 0.044424, 0.050789, 0.059884, 0.058263, 0.062755, 0.056821, 0.061248, 0.058245, 0.044717, 0.038407, 0.033467, 0.031197, 0.019348, 0.005744, -0.005321, -0.012279, -0.023885, -0.023884, -0.019678
#*# 	  -0.019359, 0.012324, 0.014960, 0.020472, 0.029956, 0.040229, 0.045079, 0.046438, 0.051882, 0.046251, 0.053041, 0.056826, 0.051883, 0.052766, 0.037965, 0.040859, 0.026249, 0.024707, 0.011509, -0.001587, -0.004403, -0.008426, -0.013288, -0.014915, -0.022362
#*# 	  -0.000854, 0.016185, 0.029668, 0.038888, 0.042049, 0.052154, 0.057896, 0.062480, 0.060197, 0.060886, 0.066993, 0.064095, 0.067571, 0.071414, 0.053897, 0.043457, 0.040665, 0.036766, 0.033023, 0.014385, 0.009849, -0.008169, -0.015618, -0.007866, -0.014223
#*# 	  -0.011162, 0.010801, 0.021329, 0.028000, 0.029085, 0.034285, 0.044504, 0.052139, 0.048741, 0.044488, 0.043110, 0.049274, 0.050119, 0.048585, 0.041594, 0.031917, 0.032481, 0.029278, 0.018338, 0.001643, -0.006367, -0.003312, -0.019200, -0.008912, -0.016747
#*# 	  -0.010495, 0.006678, 0.020955, 0.025028, 0.031535, 0.039170, 0.048386, 0.055080, 0.052920, 0.058505, 0.054344, 0.058974, 0.056971, 0.058351, 0.051295, 0.034914, 0.041547, 0.032175, 0.029178, 0.017079, 0.001926, -0.009730, -0.021933, -0.010036, -0.006285
#*# 	  -0.009949, 0.002836, 0.015014, 0.015469, 0.014601, 0.027878, 0.041221, 0.046589, 0.035900, 0.036524, 0.040176, 0.043426, 0.038261, 0.034631, 0.029769, 0.016982, 0.024883, 0.010513, 0.008407, -0.000275, -0.013014, -0.010788, -0.025183, -0.015283, -0.024014
#*# 	  -0.013388, 0.003122, 0.011023, 0.019033, 0.027564, 0.035187, 0.046138, 0.045402, 0.048067, 0.048344, 0.052303, 0.056039, 0.052831, 0.054413, 0.045821, 0.035447, 0.036558, 0.030639, 0.031381, 0.018957, 0.009036, -0.000821, -0.013301, 0.001444, 0.003702
#*# 	  -0.014141, 0.012822, 0.021660, 0.027110, 0.032529, 0.046204, 0.048333, 0.047864, 0.047864, 0.047441, 0.044750, 0.049445, 0.051073, 0.046602, 0.039596, 0.032232, 0.034702, 0.032389, 0.029655, 0.017027, 0.009845, 0.011127, -0.000981, 0.009585, 0.001338
#*# 	  -0.000981, 0.012316, 0.028892, 0.043516, 0.043985, 0.052037, 0.063310, 0.071609, 0.066626, 0.070660, 0.069751, 0.069907, 0.073422, 0.075206, 0.067594, 0.054404, 0.056238, 0.057660, 0.055127, 0.041448, 0.033353, 0.037088, 0.025613, 0.034771, 0.032411
#*# 	  -0.002521, 0.025646, 0.029185, 0.043558, 0.052461, 0.056936, 0.060252, 0.064701, 0.066970, 0.062545, 0.069440, 0.068596, 0.073860, 0.075547, 0.066137, 0.057510, 0.058705, 0.064024, 0.052384, 0.044592, 0.045236, 0.046347, 0.042342, 0.037602, 0.053181
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 213.35999999999999
#*# min_y = 30.0
#*# max_y = 193.9200000000001
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3253714.442,0.090000:3252789.152,0.130000:3251869.392,
#*# 	0.170000:3250940.872,0.210000:3250035.237,0.250000:3249103.707,
#*# 	0.290000:3248161.703,0.330000:3247270.729,0.370000:3246357.769,
#*# 	0.410000:3245430.660,0.450000:3244511.072,0.490000:3243630.724,
#*# 	0.530000:3242693.447,0.570000:3241785.241,0.610000:3240891.935,
#*# 	0.650000:3240034.191,0.690000:3239125.349,0.730000:3238240.045,
#*# 	0.770000:3237382.836,0.810000:3236535.537,0.850000:3235688.970,
#*# 	0.890000:3234860.826,0.930000:3234029.018,0.970000:3233216.185,
#*# 	1.010000:3232443.420,1.050000:3231651.248,1.090000:3230854.400,
#*# 	1.130000:3230099.451,1.170000:3229349.198,1.210000:3228586.131,
#*# 	1.250000:3227856.036,1.290000:3227117.312,1.330000:3226381.597,
#*# 	1.370000:3225671.423,1.410000:3224957.435,1.450000:3224299.377,
#*# 	1.490000:3223613.851,1.530000:3222939.594,1.570000:3222251.621,
#*# 	1.610000:3221636.368,1.650000:3221008.547,1.690000:3220369.116,
#*# 	1.730000:3219731.106,1.770000:3219162.106,1.810000:3218530.681,
#*# 	1.850000:3217962.188,1.890000:3217373.514,1.930000:3216846.961,
#*# 	1.970000:3216305.929,2.010000:3215744.329,2.050000:3215202.559,
#*# 	2.090000:3214693.839,2.130000:3214188.709,2.170000:3213663.252,
#*# 	2.210000:3213176.175,2.250000:3212710.555,2.290000:3212215.807,
#*# 	2.330000:3211758.156,2.370000:3211296.773,2.410000:3210852.122,
#*# 	2.450000:3210403.707,2.490000:3209972.963,2.530000:3209534.000,
#*# 	2.570000:3209127.873,2.610000:3208695.695,2.650000:3208286.896,
#*# 	2.690000:3207870.410,2.730000:3207467.556,2.770000:3207078.241,
#*# 	2.810000:3206714.185,2.850000:3206289.992,2.890000:3205939.295,
#*# 	2.930000:3205552.230,2.970000:3205200.480,3.010000:3204835.415,
#*# 	3.050000:3204524.979,3.090000:3204146.825,3.130000:3203810.521,
#*# 	3.170000:3203485.830,3.210000:3203160.558,3.250000:3202837.308,
#*# 	3.290000:3202506.604,3.330000:3202201.670,3.370000:3201899.403,
#*# 	3.410000:3201566.786,3.450000:3201300.387,3.490000:3200990.360,
#*# 	3.530000:3200735.038,3.570000:3200443.518,3.610000:3200172.219,
#*# 	3.650000:3199880.594,3.690000:3199622.402,3.730000:3199347.194,
#*# 	3.770000:3199086.390,3.810000:3198838.495,3.850000:3198596.313,
#*# 	3.890000:3198358.038,3.930000:3198130.134,3.970000:3197889.016,
#*# 	4.010000:3197671.831,4.050000:3197423.512
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 38.416133
#*# drift_calibration =
#*# 	3284875.109965, -1546.648422, 13.055891
#*# 	3269431.818577, -1226.125720, 10.042791
#*# 	3256243.901966, -955.082307, 7.573431
#*# 	3243808.214668, -684.064278, 5.137474
#*# 	3233092.659756, -447.425000, 3.013868
#*# 	3224135.994453, -251.407288, 1.250156
#*# 	3217922.470009, -140.090710, 0.304005
#*# 	3212070.507564, -20.046518, -0.745995
#*# 	3207412.588163, 76.051519, -1.637191
#*# drift_calibration_min_temp = 39.103461654920906
